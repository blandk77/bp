<!DOCTYPE html>
<html>
<head>
  <title>Exploring the World's Wonders</title>
  <link rel="stylesheet" href="{{ url_for('serve_static', filename='style.css') }}">
</head>
<body>

<div class="container">
  <h1>Exploring the World's Wonders</h1>

  <div id="timer">5</div>

  <button id="redirectButton">Continue</button>
  <div id="scrollMessage">Scroll down for more wonders!</div>

  <img src="https://source.unsplash.com/800x400/?travel" alt="Travel Image">

  <p>Welcome, fellow travelers! Today, we embark on a virtual journey to explore some of the most breathtaking wonders our world has to offer. From ancient ruins to natural landscapes, prepare to be amazed by the sheer beauty and historical significance of these incredible destinations.</p>

  <h2>The Great Pyramid of Giza, Egypt</h2>
  <img src="https://source.unsplash.com/800x400/?pyramid" alt="Great Pyramid of Giza">
  <p>One of the Seven Wonders of the Ancient World, the Great Pyramid of Giza stands as a testament to human ingenuity and architectural prowess. Built over 4,500 years ago, this colossal structure continues to captivate and inspire awe in all who behold it.</p>

  <h3>Exploring the Interior</h3>
  <p>Venture into the heart of the pyramid and discover the intricate network of chambers and passageways that lead to the King's Chamber. Marvel at the precision and skill of the ancient builders who constructed this monumental tomb.</p>

  <h2>Machu Picchu, Peru</h2>
  <img src="https://source.unsplash.com/800x400/?machu%20picchu" alt="Machu Picchu">
  <p>Nestled high in the Andes Mountains, Machu Picchu is an ancient Inca city shrouded in mystery and surrounded by breathtaking scenery. This UNESCO World Heritage Site offers a glimpse into the rich history and culture of the Inca civilization.</p>

  <h3>Hiking the Inca Trail</h3>
  <p>Embark on an unforgettable trek along the Inca Trail, traversing rugged terrain and lush cloud forests as you make your way to the lost city of Machu Picchu. Be prepared for challenging climbs and rewarding panoramic views.</p>

  <h2>The Colosseum, Italy</h2>
  <img src="https://source.unsplash.com/800x400/?colosseum" alt="The Colosseum">
  <p>Step back in time and witness the grandeur of the Colosseum, an ancient amphitheater that once hosted gladiatorial contests and public spectacles. This iconic landmark stands as a reminder of the Roman Empire's power and influence.</p>

    <div class="end-button-container">
              <button id="additionalButton">Discover the Final Destination</button>
    </div>

  <div id="generatingMessage">Please wait..... Generating link</div>
  <a id="finalLinkButton" href="#">Final Link</a>
</div>

<script>
 const APP_URL = "{{ app_url }}";
 // Function to get URL parameters
 function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
      results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
  }

  function decodeBase64(encodedString) {
    try {
      return atob(encodedString);
    } catch (error) {
      console.error("Error decoding Base64:", error);
      return null;
    }
  }

  let timerValue = 5;
  const timerElement = document.getElementById("timer");
  const redirectButton = document.getElementById("redirectButton");
  const additionalButton = document.getElementById("additionalButton");
  const scrollMessage = document.getElementById("scrollMessage");
  const generatingMessage = document.getElementById("generatingMessage");
  const finalLinkButton = document.getElementById("finalLinkButton");
  let finalDecodedUrl;

  //Initially hide redirect and additional button
    redirectButton.style.display = "none";
    additionalButton.style.display = "none";

  function startTimer() {
    const timerInterval = setInterval(() => {
      timerValue--;
      timerElement.textContent = timerValue;

      if (timerValue <= 0) {
        clearInterval(timerInterval);
        redirectButton.style.display = "block";
      }
    }, 1000);
  }

    function startSecondTimer() {
        additionalButton.style.display = "none";
        let secondTimerValue = 5;
        timerElement.textContent = secondTimerValue;

        const secondTimerInterval = setInterval(() => {
            secondTimerValue--;
            timerElement.textContent = secondTimerValue;

            if (secondTimerValue <= 0) {
                clearInterval(secondTimerInterval);
                generatingMessage.style.display = "block";

                setTimeout(() => {
                    generatingMessage.style.display = "none";
                    finalLinkButton.style.display = "inline-block";
                    finalLinkButton.href = finalDecodedUrl;
                }, 3000);
            }
        }, 1000);
    }

  document.addEventListener("DOMContentLoaded", function() {
    const encodedUrl = getParameterByName("url");

    if (encodedUrl) {
      const decodedUrl = decodeBase64(encodedUrl);
      finalDecodedUrl = decodedUrl;

      if (decodedUrl) {
        startTimer();

        redirectButton.addEventListener("click", function(event) {
          event.preventDefault();
          redirectButton.style.display = "none";
          scrollMessage.style.display = "block";
          additionalButton.style.display = "block"; // Show the additional button

        });

      } else {
        document.body.textContent = "Error: Invalid URL.";
      }
    } else {
      document.body.textContent = "Error: No URL provided.";
    }
  });

    additionalButton.addEventListener("click", startSecondTimer);
</script>

</body>
  </html>
